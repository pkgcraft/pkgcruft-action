name: pkgcruft
description: Run pkgcruft over an ebuild repository
inputs:
  options:
    description: Options to pass to `pkgcruft scan`
    required: false
    default: ''
    inputs:
  repo:
    description: Path to ebuild repo
    required: false
    default: './'

runs:
  using: composite
  steps:
    - uses: cargo-bins/cargo-binstall@main

    - name: Install pkgcraft-tools
      shell: bash
      run: cargo binstall --target x86_64-unknown-linux-gnu pkgcraft-tools

    - name: Install pkgcruft
      shell: bash
      run: cargo binstall --target x86_64-unknown-linux-gnu pkgcruft

    - name: Cache pkgcruft
      uses: actions/cache@v4
      with:
        path: ~/.cache/pkgcraft
        key: pkgcraft

    - name: Run pkgcruft action
      shell: bash
      run: |
        PKGCRUFT_SCAN_OPTIONS=${{ inputs.options }}
        REPO=${{ inputs.repo }}
        ./pkgcruft-action

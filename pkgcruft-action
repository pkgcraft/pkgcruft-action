#!/usr/bin/env bash

set -e

run() {
	echo $@
	$@
}

echo "Generating metadata"
run pk repo metadata regen -p ~/.cache/pkgcraft/md5-cache ${REPO}

# TODO: incorporate custom metadata dir into `pkgcruft scan` option
mkdir -p "${REPO}"/metadata
rm -rf "${REPO}"/metadata/md5-cache
ln -s ~/.cache/pkgcraft/md5-cache "${REPO}"/metadata/md5-cache

# forcibly enable color output
export CLICOLOR_FORCE=1
echo "Running pkgcruft"
run pkgcruft scan ${PKGCRUFT_SCAN_OPTIONS} ${REPO}
